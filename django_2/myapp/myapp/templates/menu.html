<html>
<html lang="en">
{% load bootstrap3 %} {% load staticfiles %} 
<head>  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{% static "bootstrap.min.css" %}">
  <script src="{% static "jquery.min.js" %}"></script>
  <script src="{% static "bootstrap.min.js" %}"></script>
<script src="{% static "jquery.min.js" %}"></script>
  <meta charset="utf-8">
   
  <link rel="stylesheet" href="{% static "jquery-ui.css" %}">
  <script src="{% static "jquery-1.10.2.js" %}"></script>
  <script src="{% static "jquery-ui.js" %}"></script>
</head>
<style>
.jumbotron{
	font-size: 20px;
}
</style>
</head>
	
<div id="heading">
	   {%if food_search%}
	   <div class="row">

	    <div class=" alert alert-info" style="text-align:center;font-size:1.5em;"> 
	    	Search Results for <strong> {{search_name}} </strong>
	    </div>
	</div>
	   {%endif%}
</div>
<div class='container'>
	<div class='well'>
	<div class='row'>
		
{%for food in foods%}

	<div class="col-md-4" id="menu{{forloop.counter}}">
		<div class='well'>
			<p align='center' > <strong> {{food.0}} </strong>  </p>
			Price:<font color="blue"> {{food.2}}</font> <br>
			Rating:<font color="blue"> {{food.4}}</font><br>
			Category:<font color="blue"> {{food.1}}</font><br>

			{%if food_search%}
			Restaurant:<font color='blue'>{{food.6}},{{food.7}}</font><br>
			{%endif%}

			<meta name="menu_id{{forloop.counter}}" content="{{food.3}}" />
			Give rating:
			<select align='left' class="dropdown" id="dropdown{{forloop.counter}}">
				<option value='1'>1</option>
				<option value='2'>2</option>
				<option value='3'>3</option>
				<option value='4'>4</option>
				<option value='5' selected>5</option>
				<option value='6'>6</option>
				<option value='7'>7</option>
				<option value='8'>8</option>
				<option value='9'>9</option>
				<option value='10'>10</option>
			</select> 
			<button class="btn btn-success btn-xs" type="submit" id="{{forloop.counter}}">submit</button> </p>
			<br>
		<div class='text-center'>
		 <button type="submit" class="btn btn-success" id="order{{forloop.counter}}" value="{{forloop.counter}}">Add to Cart</button> 
		</div>
		</div>
	</div>

{%endfor%}

</div>
</div>
</div>
<script>
	$(document).ready(function()
	{
		$('.button').click(function(event){
			if (this.id[0]=='o')
			{
				//alert("order!");
				var id=this.id;
				 $.ajax({
	            type:"GET",
	            url:"{%url 'myapp:login_varify' %}",

	            success : function(json) {
	            	console.log(json.login);
	            	if (json.login=='success')
	            	{
	            		var counter=document.getElementById(id).value
	            		console.log(counter);
	            		var menu_id="meta[name='menu_id"+counter+"']";
	            		var food_id=$(menu_id).attr('content');
	            		console.log(food_id);
	            		window.location.href = food_id;
	            	}
	            	else
	            	{
	            		alert('Please Login First');
	            	}

	            },
	        	});
			}
			else
			{
				var dropdown_id='#dropdown'+this.id;
				var menu_id="meta[name='menu_id"+this.id+"']";
				var e = $(dropdown_id).val();
	            $.ajax({
	            type:"GET",
	            url:"{%url 'myapp:login_varify' %}",

	            success : function(json) {
	            	if (json.login=='success')
	            	{
						//console.log(e);
						$.ajax({
			            type: "POST",
			            url: "{% url 'myapp:submit_rating' %}",
			            data: {
			            	csrfmiddlewaretoken: '{{ csrf_token }}',
			            	value:e,
			            	menu_id:$(menu_id).attr('content')
		            	},
		            	success : function(json) {
	            			alert("Rating Submitted Successfully!")
	            		},
	            		error: function(data) {
	            			alert("Error submitting rating!")
	            		}
	            		});

					}
	            	else 
	            	{
	            		alert('Please Login First');
	            	}
	            	console.log(json.login);
	            	
	            	//$("#entire_page").dialog();
	            	//console.log("success");
	        	},
		  		error: function(data) {
	                //alert("Please Login First")
	            }
	            });
			}
		});
		
	});
</script>
</html>